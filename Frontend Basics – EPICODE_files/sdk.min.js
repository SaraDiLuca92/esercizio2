(function(window){var SE=function(){console.log("SEPW SDK version: "+this.version);this.initialized=false;this.widgets=[];this.count=0;this.scroll=false;this.released=false;if(typeof SE_HTTPS==="undefined"){SE_HTTPS=true}this._widget=function(id){var widget=null;for(var i=0;i<this.widgets.length;i++){if(this.widgets[i].id===id){widget=this.widgets[i];break}}return widget};this.create=function(index,element){if(element.getAttribute("data-height")){element.style.height=element.getAttribute("data-height")+"px"}else{element.style.height="100%"}element.style.minHeight="300px";var id=element.getAttribute("data-id");if(id==null||id==""){id=element.getAttribute("id")!=null&&element.getAttribute("id")!=""?element.getAttribute("id"):"se-widget-"+(index+1)}element.setAttribute("id",id);var iframe=document.createElement("iframe");iframe.setAttribute("id",id);if(typeof SE_BASE!="undefined"&&element.getAttribute("data-widget")!=null){iframe.src=(SE_HTTPS?"https":"http")+"://"+SE_BASE+"/www?hash="+escape(element.getAttribute("data-widget"))+"&place_id="+escape(id)+"&sdk=1";if(element.getAttribute("data-user-id")!=null){iframe.src=iframe.src+"&se_user_id="+escape(element.getAttribute("data-user-id"))}if(element.getAttribute("data-signature")!=null){iframe.src=iframe.src+"&se_signature="+escape(element.getAttribute("data-signature"))}if(element.getAttribute("data-nonce")!=null){iframe.src=iframe.src+"&se_nonce="+escape(element.getAttribute("data-nonce"))}if(element.getAttribute("data-theme")!=null){iframe.src=iframe.src+"&se_theme="+escape(element.getAttribute("data-theme"))}if(element.getAttribute("data-default-tab")!=null){iframe.src=iframe.src+"&default_tab="+escape(element.getAttribute("data-default-tab"))}if(element.getAttribute("data-custom-data")!=null){var customData=element.getAttribute("data-custom-data");iframe.src=iframe.src+"&custom_data="+escape(customData).substr(0,256)}if(element.getAttribute("data-hide-load-button")!=null){var hide=element.getAttribute("data-hide-load-button");hide=hide.toString().toLowerCase();if(hide=="1"||hide=="true"){iframe.src=iframe.src+"&hide_load_button=1"}}}else{iframe.src=element.getAttribute("data-src")+"&place_id="+id+"&sdk=1"}if(element.getAttribute("data-width")){iframe.style.width=element.getAttribute("data-width")+"px"}else{iframe.style.width="100%"}if(element.getAttribute("data-height")){iframe.style.height=element.getAttribute("data-height")+"px"}else{iframe.style.height="100%"}iframe.style.border="none";iframe.style.overflow="scroll";iframe.style.minHeight="300px";iframe.style.minWidth="500px";iframe.frameborder=0;var _SE=this;iframe.addEventListener("load",function(){var widget=_SE._widget(id);widget.prepared=true});this.widgets.push(new SEWidget(id,iframe))};var _SE=this;this.handler=function(){_SE.scroll=true};window.addEventListener("scroll",_SE.handler,true);window.addEventListener("resize",_SE.handler,true);this.ready(function(){_SE.init()})};var SEWidgetEventsItem=function(){this.name=null;this.callback=null};var SEWidget=function(id,iframe){this.id=id;this.iframe=iframe;this.loaded=false;this.prepared=false;this.visible=function(){var element=document.getElementById(this.id);var rectangle=element.getBoundingClientRect();var viewHeight=Math.max(document.documentElement.clientHeight,window.innerHeight);return!(rectangle.bottom<0||rectangle.top-viewHeight>=0)};this.ready=function(f){if(this.prepared){f()}else{this.iframe.addEventListener("load",f)}};this.events=new SEWidgetEvents(this)};var SEWidgetEvents=function(widget){this.widget=widget;this.functions=[];this.execute=function(eventName,eventData){var result=true;var functions=this.callbacks(eventName);var i=0;for(i=0;i<functions.length;i++){result=result&&functions[i].callback(eventData)}return result};this.callbacks=function(eventName){var callbacks=this.functions.filter(function(currentValue,index){return currentValue.name===eventName});return callbacks}};SE.prototype.debug=false;SE.prototype.version="1.0.0";SEWidgetEvents.events=["beforeSendSubmission","afterSendSubmission","checkStatus","timeOver","sessionOver","welcomeUser","languageChanged"];SEWidget.prototype.events;SE.prototype.init=function(){if(!this.initialized){var widgets=document.getElementsByClassName("se-widget");if(widgets.length<=0){SEUtils.log("warn",null,"widgets not found")}for(var i=0;i<widgets.length;i++){this.create(i,widgets[i])}var _SE=this;window.addEventListener("message",function(event){var widget=_SE._widget(event.data.id);if(widget!==null){switch(event.data.event){case"enterFullScreen":widget.iframe.style.position="fixed";widget.iframe.style.top=0;widget.iframe.style.left=0;widget.iframe.style.zIndex=3e3;widget.events.execute("enterFullScreen",event.data.data);widget.iframe.contentWindow.postMessage({event:"enterFullScreen",result:true},"*");break;case"exitFullScreen":widget.iframe.style.padding="0";widget.iframe.style.position="static";widget.iframe.style.zIndex="auto";widget.events.execute("exitFullScreen",event.data.data);widget.iframe.contentWindow.postMessage({event:"exitFullScreen",result:true},"*");break;case"beforeSendSubmission":var output=widget.events.execute("beforeSendSubmission",event.data.data);var message={event:"beforeSendSubmission"};if(typeof output==="object"&&output!==null){message["result"]=true;if(output.hasOwnProperty("submission")&&typeof output["submission"]==="object"&&output["submission"]!==null){if(output["submission"].hasOwnProperty("source")){message["submissionSource"]=output["submission"]["source"]}if(output["submission"].hasOwnProperty("language")){message["submissionLanguage"]=output["submission"]["language"]}}if(output.hasOwnProperty("customData")){message["customData"]=output["customData"]}}else{message["result"]=!!output}widget.iframe.contentWindow.postMessage(message,"*");break;case"afterSendSubmission":widget.events.execute("afterSendSubmission",event.data.data);break;case"checkStatus":widget.events.execute("checkStatus",event.data.data);break;case"sessionOver":widget.events.execute("sessionOver",event.data.data);break;case"timeOver":widget.events.execute("timeOver",event.data.data);break;case"welcomeUser":widget.events.execute("welcomeUser",event.data.data);break;case"languageChanged":widget.events.execute("languageChanged",event.data.data);break}}});this.initialized=true;SEUtils.log("info",null,"init",window.SE.debug);this.load();this.monitor()}else{SEUtils.log("warn",null,"SDK has been already initialized")}};SE.prototype.load=function(){for(var i=0;i<this.widgets.length;i++){if(!this.widgets[i].loaded&&this.widgets[i].visible()){this.count++;this.widgets[i].load();if(!this.released){var _SE=this;this.widgets[i].iframe.onload=function(){_SE.load()};this.released=true;break}}}};SE.prototype.destroyWidget=function(widget){if(typeof widget!=="object"||typeof widget.iframe!=="object"){SEUtils.log("error",null,"invalid widget object");return}var iframe=widget.iframe;iframe.parentNode.removeChild(iframe);for(var i=0;i<this.widgets.length;i++){if(this.widgets[i].id===widget.id){this.widgets.splice(i,1);break}}};SE.prototype.ready=function(f){if(document.readyState!="loading"&&document.readyState!="interactive"){f()}else{window.addEventListener("load",f)}};SE.prototype.widget=function(id){if(SEUtils.areEmpty([id])){SEUtils.log("error",null,'"id" must be specified');return}var widget=this._widget(id);if(typeof widget!=="undefined"&&widget!==null){SEUtils.log("info",null,"widget",window.SE.debug);return widget}element=document.getElementById(id);if(element==null){element=document.querySelector('[data-widget][data-id="'+id+'"]')}if(element==null){SEUtils.log("error",null,"there is no widget with given ID");return null}this.create(id,element);widget=this._widget(id);widget.load();SEUtils.log("info",null,"widget",window.SE.debug);return widget};SE.prototype.monitor=function(){var _SE=this;var monitorInterval=setInterval(function(){if(_SE.scroll){_SE.load();_SE.scroll=false;if(_SE.widgets.length===_SE.count){clearInterval(monitorInterval);window.removeEventListener("scroll",_SE.handler);window.removeEventListener("resize",_SE.handler)}}},200)};SEWidget.prototype.load=function(){var widget=document.getElementById(this.id);widget.parentNode.replaceChild(this.iframe,widget);this.loaded=true;SEUtils.log("info","widget","load",window.SE.debug)};SEWidget.prototype.destroy=function(){if(window.SE){window.SE.destroyWidget(this)}SEUtils.log("info","widget","destroy",window.SE.debug)};SEWidget.prototype.loadSourceCode=function(codeLanguage,codeSource){var _widget=this;this.ready(function(){_widget.iframe.contentWindow.postMessage({event:"loadSourceCode",data:{language:typeof codeLanguage!=="undefined"?codeLanguage:null,source:typeof codeSource!=="undefined"?codeSource:null}},"*");SEUtils.log("info","widget","load source code",window.SE.debug)})};SEWidget.prototype.setSource=function(codeSource){var _widget=this;this.ready(function(){_widget.iframe.contentWindow.postMessage({event:"setSource",data:typeof codeSource!=="undefined"?codeSource:null},"*");SEUtils.log("info","widget","set source",window.SE.debug)})};SEWidget.prototype.setLanguage=function(codeLanguage){var _widget=this;this.ready(function(){_widget.iframe.contentWindow.postMessage({event:"setLanguage",data:typeof codeLanguage!=="undefined"?codeLanguage:null},"*");SEUtils.log("info","widget","set language",window.SE.debug)})};SEWidgetEvents.prototype.subscribe=function(eventName,eventCallback){if(SEUtils.areEmpty([eventName,eventCallback])){SEUtils.log("error","widget.events",'"eventName", "eventCallback" must be specified');return}if(SEWidgetEvents.events.indexOf(eventName)===-1){SEUtils.log("error","widget.events",eventName+" event does not exists");return}var event=new SEWidgetEventsItem;event.name=eventName;event.callback=eventCallback;this.functions.push(event);SEUtils.log("info","widget.events","subscribe",window.SE.debug)};SEWidgetEvents.prototype.unsubscribe=function(eventName,eventCallback){if(SEUtils.areEmpty([eventName,eventCallback])){SEUtils.log("error","widget.events",'"eventName", "eventCallback" must be specified');return}if(SEWidgetEvents.events.indexOf(eventName)===-1){SEUtils.log("error","widget.events",eventName+" event does not exists");return}var eventIndex=null;for(var i=0;i<this.functions.length;i++){if(this.functions[i].name===eventName&&this.functions[i].callback===eventCallback){eventIndex=i}}if(eventIndex===null){SEUtils.log("warn","widget.events","specified callback does not exists");return}this.functions.splice(eventIndex,1);SEUtils.log("info","widget.events","unsubscribe",window.SE.debug)};var SEUtils={};SEUtils.log=function(type,module,message,display){if(typeof display==="undefined"||display===null){display=true}if(!display){return}var log="SE";if(module!==null){log=log+" ["+module+"]"}log=log+": "+message;switch(type){case"info":console.info(log);break;case"warn":console.warn(log);break;case"error":console.error(log);break}};SEUtils.areEmpty=function(params){var result=false;for(var i=0;i<params.length;i++){if(typeof params[i]==="undefined"||params[i]===null){result=true}}return result};window.SE=new SE})(window,undefined);